#### 1 nestjs 介绍

nestjs 是一款基于 node 的后端开发框架

有人可能会问，我为什么一定要使用开发框架呢，直接使用原生 node 去开发后端可不可以呢？当然是可以的，只不过这就回到了老生常谈的问题，为什么要使用框架？

我们说框架其实是为了简化开发流程的，原因主要有以下两点：

1. 在原生开发时代，很多功能实现是需要我们自己去实现的，因为原生只提供了非常基础的功能，而框架对很多基础功能都做了更高层的封装，这些封装好的功能可以直接使用而不必去自己实现，这就节约了开发时间
2. 在原生开发时代，同种需求场景有不同的技术方案去实现，这就需要技术选型，不同的技术选型带来的开发体验和性能差距是不一样的，而框架是有一整套的完整配套方案的，针对每种需求场景，框架都已经帮你选好了最优的技术方案，直接使用就行，这也节约了开发时间，同时框架的选型必然是最优的，不必担心性能问题

由于 nestjs 是综合性的框架，采用了面向切面编程等优秀思想，方便拓展功能模块，并且开发语言采用了 ts， 因此，如果项目是长期需要迭代的项目，或者对性能有追求，需要多个子项目的项目，比如需要构建微服务架构，那么就很适合使用 nestjs 进行开发

> 适合使用 nodejs 开发的场景：
>
> 1. 有高并发需求，但是又对 CPU密集 不敏感的应用，比如聊天室、爬虫，CPU密集是指对CPU计算能力的依赖，聊天室等应用的瓶颈主要在于网络IO，因此是对IO密集敏感的应用，nodejs采用的是非阻塞IO模型，很适合这类应用
> 2. 没有后端人员，需要快速上线的应用，nodejs 开发后端的速度是不慢的
> 3. serverless或者前后一体的项目

nestjs 与其他常见的 node 框架有什么不同呢，我们可以对比一下 koajs 和 eggjs，为什么不对比 express 呢，因为 nestjs 默认选择了 express 作为 HTTP 服务的实现（express 具有稳定的生态），简单对比一下 npm 下载量和 github 增星的数量可知， nestjs 作为 2017 年诞生的框架，星数已经快追上 express 了（截止2024年10月，星星数 67k，已经超过了 express 的 65k）

其他方面，koa 和 express 只实现了 HTTP 服务，其他的路由等中间逻辑需要自己实现，eggjs 虽然有路由等实现，但是没有使用 ts，nestjs 使用 ts + 注解的开发方式更便捷，性能也更好

#### 2 环境配置

##### 2.1 node环境

nestjs 是基于 nodejs 的，因此想要使用 nestjs，首先需要安装 node，关于 node，可查询相关笔记

##### 2.2 数据库环境

可以使用 [phpStudy](https://xp.cn/php-study) 进行数据库的管理，软件安装后，会自动在安装目录下安装 nginx 和 MySQL 等开发软件，打开 phpStudy，这是一个图形化的操作界面

1. 在首页启动 MySQL
2. 点击左侧的数据库，选择创建数据库，第一次使用会提示先修改root用户的密码，随便修改，比如修改为 123456 即可
3. 再次点击创建数据库，就可以创建数据库了，依次输入数据库名称、用户名、密码即可创建，创建完成后，数据库列表会出现刚刚创建的数据库

##### 2.3 docker

docker 最主要的目的是解决软件运行环境的问题，使得软件部署到不同的地方依然是相同的运行环境，类似于虚拟机，但是无论是性能还是体积都远远优于虚拟机，实现方式也不一样，docker 占用的是进程，而虚拟机则同时占用了软硬件资源，模拟了一个完整的操作系统，docker 有几个核心概念：

1. Client（客户端）：这是用户直接与 docker 交互的方式，提供了一系列的 docker 命令用于和 docker 守护进程交互，常见命令如下

   ```shell
   docker build
   docker pull
   docker run
   ```

2. Host（服务端）：docker 服务端负责监听客户端发出的 docker 命令，主要是 docker daemon 守护进程进行监听的，守护进程就像一个 docker 管理员，监听到 docker 命令后去执行指定的操作，比如拉取镜像（image），组装容器（container），管理网络等

3. Hub（仓库）：docker hub 是一个任何人都可以使用的公共仓库，里面存放了大家创建的公共镜像，可以基于这些镜像创建自己的镜像，如果不想使用这个公共仓库，你也可以使用自己的私人仓库

docker 是用 go 语言编写的，利用 Linux 的内核功能使用 namespace 的技术提供容器隔离机制，下面介绍一些 docker 的运行命令

```shell
docker run -i -t ubuntu /bin/bash
```

运行此命令时，很明显我们想要运行 ubuntu 这个镜像，如果本地没有这个镜像，则 docker 会去 hub 下载，如果本地已有，则跳过下载，然后 docker 会创建一个容器，并分配读写文件系统和网络给它，最后启动容器，执行 /bin/bash，容器是交互式运行的，参数 -i -t 表示附加到终端使用终端进行交互

#### 3 cli脚手架

nestjs 官方为我们提供了 cli 脚手架工具，cli 是 command line interface 命令行界面的缩写，意思是官方提供的搭建项目的工具是通过命令行去使用的，脚手架是 cli 工具作为工程搭建工具的一种形象比喻

首先使用 npm 全局安装 9.0.0 版本的 nestjs cli 脚手架

```sh
npm install -g @nestjs/cli@9.0.0
```

安装完成后检查 nest 版本，输出 9.0.0 即为成功

```sh
nest --version
```

然后选择一个文件夹用于存放项目文件，就可以开始创建 nest 项目了

```sh
nest new nest-demo
```

接着 cli 工具会询问使用哪一种包管理工具，这里我们选择 pnpm，稍等片刻，命令行就会提示创建成功，使用如下命令开启 nest 项目

```sh
cd nest-demo
pnpm run start
```

































